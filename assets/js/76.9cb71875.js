(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{633:function(t,s,a){"use strict";a.r(s);var l=a(35),c=Object(l.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"logging"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[t._v("#")]),t._v(" Logging")]),t._v(" "),a("h2",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[t._v("#")]),t._v(" 基本使用")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{staticClass:"shiki github-light",staticStyle:{"background-color":"#fff"},attrs:{tabindex:"0"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("import")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logging_level ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("DEBUG")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("fmt ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"')]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("%(asctime)s")]),a("span",{staticStyle:{color:"#032F62"}},[t._v(" [")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("%(levelname)-5.5s")]),a("span",{staticStyle:{color:"#032F62"}},[t._v("] [")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("%(name)s")]),a("span",{staticStyle:{color:"#032F62"}},[t._v("] ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("%(message)s")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logging_formatter ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.Formatter(fmt)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.getLogger(")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("__name__")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.setLevel(logging_level)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("## add a default (console) handler")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("## otherwise you cannot change the default STDOUT logging level/formatter")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.StreamHandler()")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler.setLevel(logging_level)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler.setFormatter(logging_formatter)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.addHandler(handler)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("# ## file handler")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v('# handler = logging.FileHandler(filename, encoding="utf-8")')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("# handler.setLevel(logging_level)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("# handler.setFormatter(logging_formatter)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#6A737D"}},[t._v("# logger.addHandler(handler)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.debug(")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"..."')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.error(")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"..."')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#005CC5"}},[t._v("...")])]),t._v("\n"),a("span",{staticClass:"line"})])])]),a("h2",{attrs:{id:"给不同日志等级设置不同的颜色"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给不同日志等级设置不同的颜色"}},[t._v("#")]),t._v(" 给不同日志等级设置不同的颜色")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{staticClass:"shiki github-light",staticStyle:{"background-color":"#fff"},attrs:{tabindex:"0"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("import")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" re")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("from")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" platform ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("import")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" system")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("def")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#6F42C1"}},[t._v("_add_ansi_color")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("(msg, level):")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("if")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" level ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v(">=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("40")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":    ")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v("## ERROR   (red)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        color ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"31"')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("elif")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" level ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v(">=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("30")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":  ")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v("## WARNING (yellow)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        color ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"33"')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("elif")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" level ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v(">=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("20")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":  ")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v("## INFO    (normal)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        color ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"0"')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("else")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":              ")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v("## DEBUG   (dim)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        color ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"2"')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("return")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("f")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"')]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("\\x1b")]),a("span",{staticStyle:{color:"#032F62"}},[t._v("[")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("{")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("color")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("}")]),a("span",{staticStyle:{color:"#032F62"}},[t._v("m")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("{")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("msg")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("}\\x1b")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('[0m"')])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("def")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#6F42C1"}},[t._v("stream_handler_emit")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("(self: logging.StreamHandler, record: logging.LogRecord):")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("try")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".format(record)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" _add_ansi_color(msg, record.levelno)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".stream.write(msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("+")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".terminator)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".flush()")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("except")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("RecursionError")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("raise")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("except")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("Exception")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".handleError(record)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("def")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#6F42C1"}},[t._v("file_handler_emit")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("(self: logging.FileHandler, record: logging.LogRecord):")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("if")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".stream ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("is")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("None")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".stream ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("._open()")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("try")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".format(record)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" re.sub(")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("r")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"')]),a("span",{staticStyle:{color:"#22863A","font-weight":"bold"}},[t._v("\\x1b\\[")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("\\d")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("+")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('m"')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(", ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('""')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(", msg)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".stream.write(msg ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("+")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".terminator)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".flush()")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("except")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("RecursionError")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("raise")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("except")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("Exception")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("        ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("self")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(".handleError(record)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("if")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" system() ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("==")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"Windows"')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v('# raise NotImplementedError("')]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("TODO")]),a("span",{staticStyle:{color:"#6A737D"}},[t._v(': test compatibility on Windows")')])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("pass")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("else")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(":")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    logging.StreamHandler.emit ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" stream_handler_emit")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("    logging.FileHandler.emit ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" file_handler_emit")])]),t._v("\n"),a("span",{staticClass:"line"})])])]),a("h2",{attrs:{id:"避免第三方库的日志污染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免第三方库的日志污染"}},[t._v("#")]),t._v(" 避免第三方库的日志污染")]),t._v(" "),a("p",[t._v("有时偷懒直接将全局 logging level 设为 DEBUG，然而发现导入的第三方库（比如 "),a("code",[t._v("asyncio")]),t._v("）也把日志打印出来了，解决方法如下")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{staticClass:"shiki github-light",staticStyle:{"background-color":"#fff"},attrs:{tabindex:"0"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#D73A49"}},[t._v("import")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" asyncio")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logging.basicConfig(")]),a("span",{staticStyle:{color:"#E36209"}},[t._v("level")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("logging.")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("DEBUG")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(", ")]),a("span",{staticStyle:{color:"#E36209"}},[t._v("format")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("fmt)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logging.getLogger(")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"asyncio"')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(").setLevel(logging.")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("WARNING")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"})])])]),a("p",[t._v("其中具体的 logger 名称可以在 "),a("code",[t._v("logging.Logger.manager.loggerDict")]),t._v(" 中查看")]),t._v(" "),a("h2",{attrs:{id:"多进程下保存日志的一种方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程下保存日志的一种方法"}},[t._v("#")]),t._v(" 多进程下保存日志的一种方法")]),t._v(" "),a("p",[t._v("保存日志到自定义 stream，可以在使用多进程时分别保存各子进程的日志，注意 logger 应该在子进程中创建")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{staticClass:"shiki github-light",staticStyle:{"background-color":"#fff"},attrs:{tabindex:"0"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.getLogger(")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"name"')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.setLevel(loglevel)")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("log_stream ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" io.StringIO()")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" logging.StreamHandler(log_stream)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler.setLevel(loglevel)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("handler.setFormatter(logging.Formatter(fmt))")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.addHandler(handler)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.propagate ")]),a("span",{staticStyle:{color:"#D73A49"}},[t._v("=")]),a("span",{staticStyle:{color:"#24292E"}},[t._v(" ")]),a("span",{staticStyle:{color:"#005CC5"}},[t._v("False")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#24292E"}},[t._v("logger.debug(")]),a("span",{staticStyle:{color:"#032F62"}},[t._v('"..."')]),a("span",{staticStyle:{color:"#24292E"}},[t._v(")")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#005CC5"}},[t._v("...")])]),t._v("\n"),a("span",{staticClass:"line"}),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#005CC5"}},[t._v("print")]),a("span",{staticStyle:{color:"#24292E"}},[t._v("(log_stream.getvalue().strip())")])]),t._v("\n"),a("span",{staticClass:"line"})])])])])}),[],!1,null,null,null);s.default=c.exports}}]);