<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FFmpeg | Notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Notes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/notes/assets/css/0.styles.60ecb326.css" as="style"><link rel="preload" href="/notes/assets/js/app.943eb73b.js" as="script"><link rel="preload" href="/notes/assets/js/3.8465ba19.js" as="script"><link rel="preload" href="/notes/assets/js/101.7a58913c.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.74f6aed7.js"><link rel="prefetch" href="/notes/assets/js/100.034a3b93.js"><link rel="prefetch" href="/notes/assets/js/102.09374552.js"><link rel="prefetch" href="/notes/assets/js/103.11ba2dc4.js"><link rel="prefetch" href="/notes/assets/js/104.60a5964b.js"><link rel="prefetch" href="/notes/assets/js/105.86967dd8.js"><link rel="prefetch" href="/notes/assets/js/106.6862691f.js"><link rel="prefetch" href="/notes/assets/js/11.a46c7ced.js"><link rel="prefetch" href="/notes/assets/js/12.c3e4fc46.js"><link rel="prefetch" href="/notes/assets/js/13.674a5639.js"><link rel="prefetch" href="/notes/assets/js/14.fbcf5a64.js"><link rel="prefetch" href="/notes/assets/js/15.5cffcf67.js"><link rel="prefetch" href="/notes/assets/js/16.338f7843.js"><link rel="prefetch" href="/notes/assets/js/17.99d0dc21.js"><link rel="prefetch" href="/notes/assets/js/18.7a01ab35.js"><link rel="prefetch" href="/notes/assets/js/19.2feeedce.js"><link rel="prefetch" href="/notes/assets/js/2.71c806c6.js"><link rel="prefetch" href="/notes/assets/js/20.d918ee7b.js"><link rel="prefetch" href="/notes/assets/js/21.e5104b76.js"><link rel="prefetch" href="/notes/assets/js/22.2d4b2f2a.js"><link rel="prefetch" href="/notes/assets/js/23.185dc70a.js"><link rel="prefetch" href="/notes/assets/js/24.2d25e73e.js"><link rel="prefetch" href="/notes/assets/js/25.e7452036.js"><link rel="prefetch" href="/notes/assets/js/26.bea8aa87.js"><link rel="prefetch" href="/notes/assets/js/27.4f3903f2.js"><link rel="prefetch" href="/notes/assets/js/28.902dbaee.js"><link rel="prefetch" href="/notes/assets/js/29.3deb033b.js"><link rel="prefetch" href="/notes/assets/js/30.d8646ab5.js"><link rel="prefetch" href="/notes/assets/js/31.fec58167.js"><link rel="prefetch" href="/notes/assets/js/32.7dc85083.js"><link rel="prefetch" href="/notes/assets/js/33.c8ed5fae.js"><link rel="prefetch" href="/notes/assets/js/34.6e5ee31a.js"><link rel="prefetch" href="/notes/assets/js/35.ccec245a.js"><link rel="prefetch" href="/notes/assets/js/36.4789f477.js"><link rel="prefetch" href="/notes/assets/js/37.fcd1b611.js"><link rel="prefetch" href="/notes/assets/js/38.e50f556c.js"><link rel="prefetch" href="/notes/assets/js/39.c9da1f8c.js"><link rel="prefetch" href="/notes/assets/js/4.c2282a97.js"><link rel="prefetch" href="/notes/assets/js/40.ecd0969b.js"><link rel="prefetch" href="/notes/assets/js/41.d895d699.js"><link rel="prefetch" href="/notes/assets/js/42.a8f85480.js"><link rel="prefetch" href="/notes/assets/js/43.b0195426.js"><link rel="prefetch" href="/notes/assets/js/44.9bafeff7.js"><link rel="prefetch" href="/notes/assets/js/45.fc069068.js"><link rel="prefetch" href="/notes/assets/js/46.15dac1e7.js"><link rel="prefetch" href="/notes/assets/js/47.3b8c13e7.js"><link rel="prefetch" href="/notes/assets/js/48.9149ea6f.js"><link rel="prefetch" href="/notes/assets/js/49.22096f41.js"><link rel="prefetch" href="/notes/assets/js/5.0a40a8cc.js"><link rel="prefetch" href="/notes/assets/js/50.2ce15617.js"><link rel="prefetch" href="/notes/assets/js/51.ff2268fc.js"><link rel="prefetch" href="/notes/assets/js/52.c0beff8b.js"><link rel="prefetch" href="/notes/assets/js/53.5d9024f6.js"><link rel="prefetch" href="/notes/assets/js/54.a603a0a1.js"><link rel="prefetch" href="/notes/assets/js/55.73ed4382.js"><link rel="prefetch" href="/notes/assets/js/56.3d2bcd4a.js"><link rel="prefetch" href="/notes/assets/js/57.167a12d5.js"><link rel="prefetch" href="/notes/assets/js/58.93bcace4.js"><link rel="prefetch" href="/notes/assets/js/59.0820fe49.js"><link rel="prefetch" href="/notes/assets/js/6.773bcde9.js"><link rel="prefetch" href="/notes/assets/js/60.a5f5280b.js"><link rel="prefetch" href="/notes/assets/js/61.3b526050.js"><link rel="prefetch" href="/notes/assets/js/62.005a7608.js"><link rel="prefetch" href="/notes/assets/js/63.86548806.js"><link rel="prefetch" href="/notes/assets/js/64.7b4e206a.js"><link rel="prefetch" href="/notes/assets/js/65.9e44cd94.js"><link rel="prefetch" href="/notes/assets/js/66.21e77cb2.js"><link rel="prefetch" href="/notes/assets/js/67.e88c090f.js"><link rel="prefetch" href="/notes/assets/js/68.8b474706.js"><link rel="prefetch" href="/notes/assets/js/69.eebbdf3f.js"><link rel="prefetch" href="/notes/assets/js/7.76782ec6.js"><link rel="prefetch" href="/notes/assets/js/70.de49f577.js"><link rel="prefetch" href="/notes/assets/js/71.db75ed0c.js"><link rel="prefetch" href="/notes/assets/js/72.b1aeee29.js"><link rel="prefetch" href="/notes/assets/js/73.8e2a2dc8.js"><link rel="prefetch" href="/notes/assets/js/74.a7643b30.js"><link rel="prefetch" href="/notes/assets/js/75.411c51c2.js"><link rel="prefetch" href="/notes/assets/js/76.9cb71875.js"><link rel="prefetch" href="/notes/assets/js/77.0abca309.js"><link rel="prefetch" href="/notes/assets/js/78.09f80d14.js"><link rel="prefetch" href="/notes/assets/js/79.b618d8d6.js"><link rel="prefetch" href="/notes/assets/js/8.eff1670d.js"><link rel="prefetch" href="/notes/assets/js/80.3f304dd0.js"><link rel="prefetch" href="/notes/assets/js/81.5e1d22e3.js"><link rel="prefetch" href="/notes/assets/js/82.ebcf132b.js"><link rel="prefetch" href="/notes/assets/js/83.6c998c48.js"><link rel="prefetch" href="/notes/assets/js/84.1bb8ff9f.js"><link rel="prefetch" href="/notes/assets/js/85.915463e8.js"><link rel="prefetch" href="/notes/assets/js/86.54830d70.js"><link rel="prefetch" href="/notes/assets/js/87.4e330a2c.js"><link rel="prefetch" href="/notes/assets/js/88.859b8d56.js"><link rel="prefetch" href="/notes/assets/js/89.31aa01fb.js"><link rel="prefetch" href="/notes/assets/js/9.7bbf0480.js"><link rel="prefetch" href="/notes/assets/js/90.9382184f.js"><link rel="prefetch" href="/notes/assets/js/91.8bb2e809.js"><link rel="prefetch" href="/notes/assets/js/92.44badc72.js"><link rel="prefetch" href="/notes/assets/js/93.091e597a.js"><link rel="prefetch" href="/notes/assets/js/94.eb6ff046.js"><link rel="prefetch" href="/notes/assets/js/95.bccd7cb6.js"><link rel="prefetch" href="/notes/assets/js/96.b8e239ca.js"><link rel="prefetch" href="/notes/assets/js/97.f5f281d8.js"><link rel="prefetch" href="/notes/assets/js/98.90797ed2.js"><link rel="prefetch" href="/notes/assets/js/99.98568f98.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.60ecb326.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ML and Math" class="dropdown-title"><span class="title">ML and Math</span> <span class="arrow down"></span></button> <button type="button" aria-label="ML and Math" class="mobile-dropdown-title"><span class="title">ML and Math</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/ml/" class="nav-link">
  Machine Learning
</a></li><li class="dropdown-item"><!----> <a href="/notes/math/" class="nav-link">
  Math
</a></li></ul></div></div><div class="nav-item"><a href="/notes/software/" class="nav-link router-link-active">
  Software and Tools
</a></div><div class="nav-item"><a href="/notes/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/notes/langs/" class="nav-link">
  Languages
</a></div><div class="nav-item"><a href="/notes/reading/" class="nav-link">
  Reading
</a></div><div class="nav-item"><a href="/notes/others/" class="nav-link">
  Others
</a></div> <a href="https://github.com/yzhang-gh/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ML and Math" class="dropdown-title"><span class="title">ML and Math</span> <span class="arrow down"></span></button> <button type="button" aria-label="ML and Math" class="mobile-dropdown-title"><span class="title">ML and Math</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/ml/" class="nav-link">
  Machine Learning
</a></li><li class="dropdown-item"><!----> <a href="/notes/math/" class="nav-link">
  Math
</a></li></ul></div></div><div class="nav-item"><a href="/notes/software/" class="nav-link router-link-active">
  Software and Tools
</a></div><div class="nav-item"><a href="/notes/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/notes/langs/" class="nav-link">
  Languages
</a></div><div class="nav-item"><a href="/notes/reading/" class="nav-link">
  Reading
</a></div><div class="nav-item"><a href="/notes/others/" class="nav-link">
  Others
</a></div> <a href="https://github.com/yzhang-gh/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Windows</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/software/windows/autohotkey.html" class="sidebar-link">AutoHotkey</a></li><li><a href="/notes/software/windows/context-menu.html" class="sidebar-link">自定义右键菜单</a></li><li><a href="/notes/software/windows/general.html" class="sidebar-link">一般问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>General</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/software/vim.html" class="sidebar-link">Vim</a></li><li><a href="/notes/software/shell.html" class="sidebar-link">Shell</a></li><li><a href="/notes/software/powershell.html" class="sidebar-link">PowerShell</a></li><li><a href="/notes/software/docker.html" class="sidebar-link">Docker</a></li><li><a href="/notes/software/ffmpeg.html" aria-current="page" class="active sidebar-link">FFmpeg</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#拼接多个视频" class="sidebar-link">拼接多个视频</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#格式转换" class="sidebar-link">格式转换</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#图像和视频相互转换" class="sidebar-link">图像和视频相互转换</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#多个视频-side-by-side" class="sidebar-link">多个视频 side-by-side</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#裁剪缩放填衬视频" class="sidebar-link">裁剪、缩放、填衬视频</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#叠加视频" class="sidebar-link">叠加视频</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#仅保留视频或音频" class="sidebar-link">仅保留视频或音频</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#添加文字" class="sidebar-link">添加文字</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#gpu" class="sidebar-link">GPU</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#查看帮助" class="sidebar-link">查看帮助</a></li><li class="sidebar-sub-header"><a href="/notes/software/ffmpeg.html#extra" class="sidebar-link">Extra</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ffmpeg"><a href="#ffmpeg" class="header-anchor">#</a> FFmpeg</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果是在 conda 环境中最好提前手动安装</p> <div class="language-bash extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">conda</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#032F62;">x264</span></span>
<span class="line"></span></code></pre></div><p>否则安装其它包如 PyTorch 时会自动安装不支持 libx264 的版本</p></div> <h2 id="拼接多个视频"><a href="#拼接多个视频" class="header-anchor">#</a> 拼接多个视频</h2> <p>首先创建一个 <code>mylist.txt</code> 文件，格式如下</p> <div class="language-plaintextc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6A737D;"># this is a comment</span></span>
<span class="line"><span style="color:#24292E;">file '/path/to/file1.mp4'</span></span>
<span class="line"><span style="color:#24292E;">file '/path/to/file2.mp4'</span></span>
<span class="line"><span style="color:#24292E;">file '/path/to/file3.mp4'</span></span>
<span class="line"></span></code></pre></div><p>在 Windows Command-Line 中可以使用如下命令快速为当前文件夹生成上述文件</p> <div class="language- extra-class"><pre><code>(for %i in (*.mp4) do @echo file '%i') &gt; mylist.txt
</code></pre></div><p>进行拼接</p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">concat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-safe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mylist.txt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">copy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><p>默认的 <code>-safe 1</code> 参数对输入文件路径的限制比较多</p> <blockquote><p>The paths listed within your text file are interpreted by ffmpeg as being relative to the location of your text file. (In particular, the paths listed are not relative to the current working directory.) <a href="https://superuser.com/a/943258/950027" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p><a href="https://trac.ffmpeg.org/wiki/Concatenate" target="_blank" rel="noopener noreferrer">https://trac.ffmpeg.org/wiki/Concatenate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="格式转换"><a href="#格式转换" class="header-anchor">#</a> 格式转换</h2> <h3 id="mp4"><a href="#mp4" class="header-anchor">#</a> MP4</h3> <p>转换 <code>mkv</code>，<code>avi</code> 为 <code>mp4</code></p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mkv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">copy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><p>转换 <code>wmv</code> 为 <code>mp4</code></p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.wmv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c:v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libx264</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-crf</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">17</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><p><a href="https://trac.ffmpeg.org/wiki/Encode/H.264" target="_blank" rel="noopener noreferrer">https://trac.ffmpeg.org/wiki/Encode/H.264<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="动图"><a href="#动图" class="header-anchor">#</a> 动图</h3> <h4 id="gif"><a href="#gif" class="header-anchor">#</a> GIF</h4> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ss</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">-vf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;fps=10,scale=320:-1:flags=lanczos,split[a][b];[a]palettegen[p];[b][p]paletteuse&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">output.gif</span></span>
<span class="line"></span></code></pre></div><p><a href="https://superuser.com/a/556031" target="_blank" rel="noopener noreferrer">https://superuser.com/a/556031<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="webp"><a href="#webp" class="header-anchor">#</a> WebP</h4> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ss</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vcodec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libwebp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;fps=fps=15,scale=640:360&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">-lossless</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-loop</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-preset</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-an</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vsync</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.webp</span></span>
<span class="line"></span></code></pre></div><p><a href="https://gist.github.com/witmin/1edf926c2886d5c8d9b264d70baf7379" target="_blank" rel="noopener noreferrer">https://gist.github.com/witmin/1edf926c2886d5c8d9b264d70baf7379<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>需要裁剪的时候在 <code>-vf</code> 中加入 <code>crop=w:h:x:y</code> 即可</p> <h2 id="图像和视频相互转换"><a href="#图像和视频相互转换" class="header-anchor">#</a> 图像和视频相互转换</h2> <h3 id="将图像序列合并为视频"><a href="#将图像序列合并为视频" class="header-anchor">#</a> 将图像序列合并为视频</h3> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> [-framerate 24] </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">images/%</span><span style="color:#005CC5;">4d.jpg</span><span style="color:#24292E;"> [-frames:v </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">num_frames</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">] [-s 1920x1080] [-crf 18] </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><p>也可以使用 glob 选择图片 <code>-pattern_type glob -i 'images/*.jpg'</code>（因为 glob pattern 包含星号等特殊符号所以注意使用引号）</p> <h3 id="将视频拆成图片"><a href="#将视频拆成图片" class="header-anchor">#</a> 将视频拆成图片</h3> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mov</span><span style="color:#24292E;"> [-qscale:v 2] [-vf fps</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">1] [-start_number 100] </span><span style="color:#032F62;">images/%</span><span style="color:#005CC5;">6d.jpg</span></span>
<span class="line"></span></code></pre></div><ul><li><code>-qscale:v</code>（或者缩写 <code>-q:v</code>）来控制 JPEG 的质量，范围 2–31（<a href="https://stackoverflow.com/a/10234065/8682688" target="_blank" rel="noopener noreferrer">链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li> <li><code>fps=1</code> 即每秒取一张图，如果是 <code>fps=1/2</code> 则相当于每两秒取一张图</li></ul> <h2 id="多个视频-side-by-side"><a href="#多个视频-side-by-side" class="header-anchor">#</a> 多个视频 side-by-side</h2> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">left.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">right.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-filter_complex</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hstack</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><p>如果是三个视频则可以使用 <code>hstack=inputs=3</code></p> <p>除了 <code>hstack</code> 和 <code>vstack</code>，还可以使用 <code>xstack</code>，其支持参数比如 <code>grid=3x2</code>（3 列 2 行），比较旧的版本可能还不支持（可以从 <a href="https://github.com/BtbN/FFmpeg-Builds" target="_blank" rel="noopener noreferrer">FFmpeg-Builds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载 Linux 下编译好的单文件二进制）</p> <h2 id="裁剪缩放填衬视频"><a href="#裁剪缩放填衬视频" class="header-anchor">#</a> 裁剪、缩放、填衬视频</h2> <ul><li><strong><code>crop=&lt;w&gt;:&lt;h&gt;:&lt;x&gt;:&lt;y&gt;</code></strong></li> <li><strong><code>scale=&lt;w&gt;:&lt;h&gt;</code></strong></li> <li><strong><code>pad=&lt;w&gt;:&lt;h&gt;:&lt;x&gt;:&lt;y&gt;[:&lt;color&gt;]</code></strong></li></ul> <p><code>w</code> 和 <code>h</code> 可以只指定一个值，另一个用 <code>-1</code> 由原本的长宽比来确定，<code>-2</code> 则额外要求其是偶数</p> <p>使用逗号 <code>,</code> 连接，依次应用多个 filter (<a href="https://trac.ffmpeg.org/wiki/FilteringGuide" target="_blank" rel="noopener noreferrer">FilteringGuide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6A737D;">## 将视频缩放为 200x200，然后竖直方向居中填充至 200x400 大小</span></span>
<span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">'scale=200:200,pad=200:400:0:(oh-ih)/2'</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output</span></span>
<span class="line"></span></code></pre></div><p>可以使用 <code>iw</code>，<code>ow</code>，<code>ih</code>，<code>oh</code> 等变量，以及 <code>/</code>，<code>*</code> 等来计算相应参数</p> <p><a href="https://ffmpeg.org/ffmpeg-filters.html" target="_blank" rel="noopener noreferrer">https://ffmpeg.org/ffmpeg-filters.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="叠加视频"><a href="#叠加视频" class="header-anchor">#</a> 叠加视频</h2> <p>将 <code>fg.mp4</code> 缩小、变透明，然后叠加在 <code>bg.mp4</code> 左下角</p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bg.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">fg.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-filter_complex</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#032F62;">'[0:v]null[bg]; \</span></span>
<span class="line"><span style="color:#032F62;">[1:v]scale=-1:480,format=rgba,colorchannelmixer=aa=0.8[fg]; \</span></span>
<span class="line"><span style="color:#032F62;">[bg][fg]overlay=0:(main_h-overlay_h)'</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">-crf </span><span style="color:#005CC5;">15</span><span style="color:#24292E;"> </span><span style="color:#032F62;">out.mp4</span></span>
<span class="line"></span></code></pre></div><p>（如果运行有问题可以将 filter 参数写成一行再运行）</p> <h2 id="仅保留视频或音频"><a href="#仅保留视频或音频" class="header-anchor">#</a> 仅保留视频或音频</h2> <p><code>-an</code> 去除音频</p> <div class="language- extra-class"><pre><code>ffmpeg -i input.mp4 -c copy -an output.mp4
</code></pre></div><p><code>-vn</code> 去除视频</p> <div class="language- extra-class"><pre><code>ffmpeg -i input.mp4 -c copy -vn output.aac
</code></pre></div><h2 id="添加文字"><a href="#添加文字" class="header-anchor">#</a> 添加文字</h2> <p><a href="https://ffmpeg.org/ffmpeg-filters.html#drawtext-1" target="_blank" rel="noopener noreferrer"><code>drawtext</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> filter</p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#24292E;">style_str</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;fontfile=noto-sans.ttf:fontsize=36:fontcolor=white:shadowx=2:shadowy=2:shadowcolor=black&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;drawtext=text='hello world':x=60:y=60:</span><span style="color:#24292E;">$style_str</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-crf</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><ul><li><code>text</code> 参数里还可以使用变量，比如 <code>text=%{n}</code> 表示帧号，起始为 0（由另一个参数 <code>start_number</code> 控制）</li> <li><code>box</code> 参数可以给文字加背景框，<code>box=1:boxcolor=white@0.5:boxborderw=5</code></li></ul> <h2 id="gpu"><a href="#gpu" class="header-anchor">#</a> GPU</h2> <p><a href="https://docs.nvidia.com/video-technologies/video-codec-sdk/12.0/ffmpeg-with-nvidia-gpu/index.html#quality-testing" target="_blank" rel="noopener noreferrer">Using FFmpeg with NVIDIA GPU Hardware Acceleration – NVIDIA Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vsync</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-hwaccel</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cuvid</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c:v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">h264_cuvid</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input.mp4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c:a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">copy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c:v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">h264_nvenc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">-b:v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-cq</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.mp4</span></span>
<span class="line"></span></code></pre></div><blockquote><p>where</p> <div class="language- extra-class"><pre><code>-b:v 0  overrides the default 2mbps bitrate as noted by Gyan
-cq 1   target quality level (range of 0-51)
        0 means automatic (in my case around 15mbps)
        1 gives about 15mbps, 26 results in around 5mbps, 51 results in 0.5mbps
</code></pre></div><p><a href="https://video.stackexchange.com/a/30625" target="_blank" rel="noopener noreferrer">Configure CQP (CRF) for h264_nvenc – StackExchange<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>HEVC 编码就用 <code>hevc_nvenc</code></p> <p><a href="https://trac.ffmpeg.org/wiki/HWAccelIntro#CUDANVENCNVDEC" target="_blank" rel="noopener noreferrer">HWAccelIntro &gt; CUDA (NVENC/NVDEC) – FFmpeg<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>查看 encoder 帮助</p> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">encoder=h264_nvenc</span></span>
<span class="line"></span></code></pre></div><p>其中有 supported pixel formats 信息以及 encoder 设置项</p> <h3 id="编码质量"><a href="#编码质量" class="header-anchor">#</a> 编码质量</h3> <p>GPU 最高质量使用 <code>-preset p7</code> 和 <code>-pix_fmt p010le</code> (10 bit depth)，<code>-rc-lookahead 20</code></p> <p><a href="https://www.reddit.com/r/ffmpeg/comments/ystse6/hevc_nvenc_2pass_question/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/ffmpeg/comments/ystse6/hevc_nvenc_2pass_question/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.zhihu.com/question/22501094" target="_blank" rel="noopener noreferrer">GPU 转码效果为什么不如纯 CPU？– 知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <p>此外，不论是否使用 GPU 编码，<strong>关键帧间隔</strong>可以使用 <code>-g</code> 参数 (Group of Picture size) 设置，可以理解为两个关键帧之间的帧数。如果希望每 3 秒一个关键帧则可以设置为 3 倍 fps 大小</p> <h2 id="查看帮助"><a href="#查看帮助" class="header-anchor">#</a> 查看帮助</h2> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">filter=xstack</span></span>
<span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">encoder=h264_nvenc</span></span>
<span class="line"></span></code></pre></div><h2 id="extra"><a href="#extra" class="header-anchor">#</a> Extra</h2> <h3 id="视频下载工具-lux"><a href="#视频下载工具-lux" class="header-anchor">#</a> 视频下载工具 <a href="https://github.com/iawia002/lux" target="_blank" rel="noopener noreferrer">lux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>e.g. Bilibili</p> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6A737D;">## -c 提供 cookie</span></span>
<span class="line"><span style="color:#6A737D;">## -i 查询提供的格式</span></span>
<span class="line"><span style="color:#6A737D;">## -f 下载指定的格式</span></span>
<span class="line"><span style="color:#6F42C1;">lux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;SESSDATA=&lt;cookie_value&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://www.bilibili.com/video/BVxxxxxxxxxx/&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">lux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;SESSDATA=&lt;cookie_value&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">80-7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://www.bilibili.com/video/BVxxxxxxxxxx/&quot;</span></span>
<span class="line"></span></code></pre></div><details class="custom-block details"><summary><code>youtube-dl</code></summary> <p>list available formats</p> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">youtube-dl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span><span style="color:#24292E;"> &lt;</span><span style="color:#032F62;">ur</span><span style="color:#24292E;">l&gt;</span></span>
<span class="line"></span></code></pre></div><p>download the selected format</p> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">youtube-dl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> &lt;</span><span style="color:#032F62;">format_cod</span><span style="color:#24292E;">e&gt; &lt;</span><span style="color:#032F62;">ur</span><span style="color:#24292E;">l&gt;</span></span>
<span class="line"></span></code></pre></div><p>others</p> <div class="language-shelldoc extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6F42C1;">youtube-dl</span><span style="color:#24292E;"> [--proxy </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">proxy</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">] </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">'bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio'</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--merge-output-format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mp4</span><span style="color:#24292E;"> &lt;</span><span style="color:#032F62;">ur</span><span style="color:#24292E;">l&gt;</span></span>
<span class="line"></span></code></pre></div></details> <h3 id="fix-for-too-short-error-on-avidemux"><a href="#fix-for-too-short-error-on-avidemux" class="header-anchor">#</a> Fix for &quot;Too short!&quot; error on avidemux</h3> <div class="language-shell extra-class"><pre tabindex="0" class="shiki github-light" style="background-color:#fff;"><code><span class="line"><span style="color:#6A737D;"># This will recreate timestamps on the stream allowing avidemux to export the file.</span></span>
<span class="line"><span style="color:#6A737D;"># Note that the output has to be a Matroska container (.mkv).</span></span>
<span class="line"><span style="color:#6A737D;"># &lt;https://gist.github.com/dmcallejo/3aef05029222eb38604a61b1623784c8&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-start_at_zero</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-copyts</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">input_file.ts</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-map</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">copy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-map</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:a:</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output_file.mkv</span></span>
<span class="line"></span></code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last updated:</span> <span class="time">2/8/2025, 8:31:23 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/software/docker.html" class="prev">
        Docker
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/notes/assets/js/app.943eb73b.js" defer></script><script src="/notes/assets/js/3.8465ba19.js" defer></script><script src="/notes/assets/js/101.7a58913c.js" defer></script>
  </body>
</html>
